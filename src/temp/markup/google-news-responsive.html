<!DOCTYPE html>
<html>

<head>
	<meta charset='utf-8'>
	<title>Google News</title>
	<meta name='viewport' content='width=device-width, initial-scale=1.0'>

	<link rel="stylesheet" type="text/css" href="../styles/google-news-responsive.css">
	<script src="//code.jquery.com/jquery.min.js"></script>
	<script src='//cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0/handlebars.min.js'>
	</script>
</head>

<body>
	<section id='rendered'></section>
	<script id="template" type="text/x-handlebars-template">
		<h3>Google News</h3>
		<ul>
			{{#entries}}
			<li>
				<a href='{{link}}' target='_blank'>
					<div class='date gray'>{{publishedDate}}</div>
					<div class='author gray'>{{authorFormatted author}}</div>
					<div class='clearboth'></div>
					<div>{{title}}</div>
					<div class='gray'>Categories: {{categoryList categories}}</div>
				</a>
			</li>
			{{/entries}}
		</ul>
	</script>

	<script>
		 !function (d, $) {
            // Aggregate string array to string
			Handlebars.registerHelper('categoryList', function (categories) {
				if (!categories) return '';
				if (categories.length === 1) return categories[0];

				return categories.reduce(function (a, b) {
					return a + b + ', ';
				}, '');
			});

            // Format author data
			Handlebars.registerHelper('authorFormatted', function (author) {
				if (!author) return '- Unknown author';
				return '- ' + author
			});

            // Json url
			var url = '//ajax.googleapis.com/ajax/services/feed/load?v=1.0';
			url += '&num=10&q=http://news.google.com/news?output=rss';

            // Get json data from Google
			$.ajax({
				url: url,
				type: 'GET',
                // avoid having no CORS policy by using jsonp
				dataType: 'jsonp', 
				success: function (result) {                  
					data = result; // save to global var for debugging

                    // If download was success, then apply rendering
					if (result.responseStatus === 200) {
						var templateSource = $('#template').html();
						var template = Handlebars.compile(templateSource);
						var html = template(result.responseData.feed);
						$('#rendered').append(html);
					}
				},
				error: function (result) {
					console.log(result);
					$('#rendered').append('ERROR - ' + JSON.stringify(result));
				}
			});
		}(document, jQuery);
	</script>
</body>

</html>
